/**
 * 
 */
package com.pramati.imaginea.bObj;

import java.io.BufferedWriter;
import java.io.File;
import java.io.FileWriter;
import java.net.URL;

import javax.xml.bind.JAXBContext;
import javax.xml.bind.Unmarshaller;

import com.pramati.imaginea.Entities.MailContent;
import com.pramati.imaginea.Exceptions.NoDataException;
import com.pramati.imaginea.base.WebElement;

/**
 * @author anandu
 *
 */
public class WebMailLink implements WebElement {
	
	private URL linkUrl;
	private boolean isLoaded;
	MailContent email;
	/**
	 * 
	 */
	public WebMailLink(URL url) {
		this.linkUrl = url;
		this.isLoaded = false;
	}

	/* (non-Javadoc)
	 * @see com.pramati.imaginea.base.WebElement#save(java.lang.Object)
	 */
	@Override
	public void save(File targetFile) throws Exception {
		if(!isLoaded) {
			
		}
		load();
		if (email == null) {
			throw new NoDataException();
		}
		File lFile = new File(targetFile, email.getFrom());
		lFile.createNewFile();
		FileWriter lWriter = new FileWriter(lFile.getAbsoluteFile());
		BufferedWriter lBuffer = new BufferedWriter(lWriter);
		lBuffer.write(email.getDate());
		lBuffer.write("\n");
		lBuffer.write(email.getFrom());
		lBuffer.write("\n");
		lBuffer.write(email.getContents());
		lBuffer.flush();
		lBuffer.close();
	}

	@Override
	public void load() throws Exception {
		
		JAXBContext jaxbContext = JAXBContext.newInstance(MailContent.class);  
		Unmarshaller jaxbUnmarshaller = jaxbContext.createUnmarshaller();  
		email = (MailContent) jaxbUnmarshaller.unmarshal(linkUrl);
		
	}

}
